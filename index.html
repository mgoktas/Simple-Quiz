<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>

    <div class="btn_start">
        <button class="btn btn-warning btn-lg">Start Quiz</button>
    </div>

    <div class="card quiz_box">
        <header class="card-header">
            <div class="title">Quiz App</div>
            <div class="timer">
                <div class="time_text">Remaining Time</div>
                <div class="time_second"> </div>
            </div>
            <div class="time_line"></div>
        </header>
        <section class="card-body">
            <div class="question_text">
                <!-- <span>Hangisi javascript paket yönetim uygulasıdır?</span> -->
            </div>
            <div class="option_list">
                <!-- <div class="option">
                    <span>a: Node.js</span>
                    <div class="icon"><i class="fas fa-check"></i></div>
                </div>
                <div class="option">
                    <span>b: Typescript</span>
                    <div class="icon"><i class="fas fa-times"></i></div>
                </div>
                <div class="option correct">
                    <span>c: Npm</span>
                    <div class="icon"><i class="fas fa-times"></i></div>
                </div>
                <div class="option incorrect">
                    <span>d: Nuget</span>
                    <div class="icon"><i class="fas fa-times"></i></div>
                </div> -->
            </div>
        </section>
        <footer class="card-footer d-flex justify-content-between align-items-center">
            <button class="next_btn btn btn-primary btn-sm">Next</button>
            <div class="question_index"><span class="badge bg-warning my-2">1 / 4</span></div>
        </footer>
    </div>

    <div class="card score_box">
        <div class="icon"><div class="fas fa-crown"></div></div>
        <div class="score_text"></div>
        <button class="btn btn-primary btn_replay w-25 my-4">Replay</button>
        <button class="btn btn-primary btn_quit w-25 my-4">End</button>
    </div>
    
    <script src="question.js">function Question(questionText, options, correctAnswer) {
    this.questionText = questionText;
    this.options = options;
    this.correctAnswer = correctAnswer;
}

Question.prototype.checkAnswer = function(answer) {
    return answer === this.correctAnswer
}

let questions = [
    new Question("1-Which language is the package manager for Javascript ", { a: "Node.js", b: "Typescript", c: "Npm" , d: "Nuget" }, "c"),
    new Question("2-Which language is not considered as a frontend langugage? ", { a: "css", b: "html", c: "javascipt", d: "sql" }, "d"),
    new Question("3-Which language is considered as a backend language? ", { a: "node.js", b: "typescript", c: "angular", d: "react" }, "a"),
    new Question("4-Which language does not use javascript?", { a: "react", b: "angular", c: "vuejs", d: "asp.net" }, "d")
];</script>
    <script src="quiz.js">function Quiz(questions) {
    this.questions = questions;
    this.questionIndex = 0;
    this.correctAnswers = 0
}

Quiz.prototype.bringQuestion = function() {
    return this.questions[this.questionIndex];
}</script>
    <script src="ui.js">const quiz = new Quiz(questions);
const ui = new UI();

ui.btn_start.addEventListener("click", function() {
    ui.quiz_box.classList.add("active");
    startTimer(10)
    startTimerLine()
    ui.showQuestion(quiz.bringQuestion());
    ui.showTotalQuestion(quiz.questionIndex + 1, quiz.questions.length);
    ui.btn_next.classList.remove("show");
})

ui.btn_next.addEventListener("click", function() {
    if (quiz.questions.length != quiz.questionIndex + 1) {
        quiz.questionIndex += 1;
        clearInterval(counter)    
        clearInterval(counterLine)
        startTimer(10)
        startTimerLine()
        ui.showQuestion(quiz.bringQuestion());
        ui.showTotalQuestion(quiz.questionIndex + 1, quiz.questions.length);
        ui.btn_next.classList.remove("show");
    } else {
        clearInterval(counter)    
        console.log("quiz is ended");
        ui.quiz_box.classList.remove("active");
        ui.score_box.classList.add("active")
        ui.showScore(quiz.questions.length, quiz.correctAnswers)
    }
});

ui.btn_quit.addEventListener("click", function(){
    window.location.reload()
})

ui.btn_replay.addEventListener("click", function(){
    quiz.questionIndex = 0
    quiz.correctAnswers = 0
    ui.btn_start.click()
    ui.score_box.classList.remove("active")
})


function optionSelected(option) {
    clearInterval(counter)   
    clearInterval(counterLine) 
    let answer = option.querySelector("span b").textContent;
    let question = quiz.bringQuestion();

    if(question.checkAnswer(answer)) {
        quiz.correctAnswers += 1
        option.classList.add("correct");
        option.insertAdjacentHTML("beforeend", ui.correctIcon);
    } else {
        option.classList.add("incorrect");
        option.insertAdjacentHTML("beforeend", ui.incorrectIcon);
    }

    for(let i=0; i < ui.option_list.children.length; i++) {
        ui.option_list.children[i].classList.add("disabled");
    }

    ui.btn_next.classList.add("show");
}

let counter

function startTimer(time) {
    counter = setInterval(timer, 1000)

    function timer() {
        ui.time_second.textContent = time
        time--

        if (time<0) {
        clearInterval(counter)
        ui.time_text.textContent = "Time is up."
        
        let answer = quiz.bringQuestion().correctAnswer
            
        for (let option  of ui.option_list.children) {
            console.log(option)
            console.log(answer)
            if (option.querySelector("span b").textContent == answer) {
                option.classList.add("correct");
                option.insertAdjacentHTML("beforeend", ui.correctIcon);
   

            }

            option.classList.add("disabled")
        }
        ui.btn_next.classList.add("show")
    }
}
}

let counterLine
function startTimerLine() {
    let line_width = 0
    
    counterLine = setInterval(timer, 20 )
    
    function timer() {
        line_width += 1
        ui.time_line.style.width = line_width + "px"
    
        if(line_width > 540 ) {
            clearInterval(counterLine)
        }

    }}
    </script>
    <script src="script.js">function UI() {
    this.btn_start = document.querySelector(".btn_start"),
    this.btn_next = document.querySelector(".next_btn"),
    this.btn_replay = document.querySelector(".btn_replay"),
    this.btn_quit = document.querySelector(".btn_quit"),
    this.score_box = document.querySelector(".score_box"),
    this.quiz_box = document.querySelector(".quiz_box"),
    this.option_list = document.querySelector(".option_list"),
    this.correctIcon = '<div class="icon"><i class="fas fa-check"></i></div>',
    this.incorrectIcon = '<div class="icon"><i class="fas fa-times"></i></div>'
    this.time_text = document.querySelector(".time_text")
    this.time_second = document.querySelector(".time_second")
    this.time_line = document.querySelector(".time_line")
}

UI.prototype.showQuestion = function(question) {
    let questioN = `<span>${question.questionText}</span>`;
    let options = '';

    for(let answer in question.options) {
        options += 
            `
                <div class="option"> 
                    <span><b>${answer}</b>: ${question.options[answer]}</span>
                </div>
            `;
    }
    document.querySelector(".question_text").innerHTML = questioN;
    this.option_list.innerHTML = options;

    const option = this.option_list.querySelectorAll(".option");

    for(let opt of option) {
        opt.setAttribute("onclick", "optionSelected(this)")
    }
}

UI.prototype.showTotalQuestion = function(questionIndex, totalQuestion) {
    let tag = `<span class="badge bg-warning">${questionIndex} / ${totalQuestion}</span>`;
    document.querySelector(".quiz_box .question_index").innerHTML = tag;
}

UI.prototype.showScore = function (totalQuestion, correctAnswer) {
    let tag = `You have ${correctAnswer} correct answers in ${totalQuestion} questions. `
    document.querySelector(".score_box .score_text").innerHTML = tag
}</script>   
</body>
</html>
